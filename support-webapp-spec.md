# ะกะฟะตัะธัะธะบะฐัะธั: Telegram WebApp โ ะกะปัะถะฑะฐ ะฟะพะดะดะตัะถะบะธ

> ะะตััะธั: 1.0  
> ะกัะฐััั: ะะพัะพะฒะพ ะบ ัะฐะทัะฐะฑะพัะบะต

---

## 1. ะะฑะทะพั

Telegram Mini App ะดะปั ะพะฑัะฐะฑะพัะบะธ ะพะฑัะฐัะตะฝะธะน ะฒ ัะปัะถะฑั ะฟะพะดะดะตัะถะบะธ. ะะพะปัะทะพะฒะฐัะตะปะธ ะฒะทะฐะธะผะพะดะตะนััะฒััั ัะตัะตะท WebApp, ัะฒะตะดะพะผะปะตะฝะธั ะฟัะธัะพะดัั ัะตัะตะท Telegram-ะฑะพัะฐ. ะะฐัััะธัะฐะฝะพ ะฝะฐ ~20 ะฟะพะปัะทะพะฒะฐัะตะปะตะน.

---

## 2. ะกัะตะบ ัะตัะฝะพะปะพะณะธะน

| ะกะปะพะน | ะขะตัะฝะพะปะพะณะธั |
|---|---|
| Backend | Python 3.11+ + FastAPI |
| ะะฐะทะฐ ะดะฐะฝะฝัั | SQLite (SQLAlchemy ORM) |
| Telegram-ะฑะพั | python-telegram-bot |
| Frontend | Vanilla JS + Telegram WebApp SDK + Tailwind CDN |
| ะะฒัะพัะธะทะฐัะธั | Telegram initData (HMAC-ะฒะฐะปะธะดะฐัะธั) + JWT |
| ะะตะฟะปะพะน | Single server, ะพะดะธะฝ ะฟัะพัะตัั (FastAPI ะพัะดะฐัั API + ััะฐัะธะบั) |

ะะธะบะฐะบะธั React/Vue โ ะธะทะฑััะพัะฝะพ ะดะปั ะดะฐะฝะฝะพะณะพ ะผะฐัััะฐะฑะฐ.

---

## 3. ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
/
โโโ app/
โ   โโโ main.py              # FastAPI app, ะฟะพะดะบะปััะตะฝะธะต ัะพััะตัะพะฒ
โ   โโโ bot.py               # Telegram bot, ะพัะฟัะฐะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน
โ   โโโ config.py            # ะะฐะณััะทะบะฐ ะบะพะฝัะธะณะฐ (admins, support ids)
โ   โโโ database.py          # ะะฝะธัะธะฐะปะธะทะฐัะธั SQLite, ัะตััะธะธ
โ   โโโ models.py            # SQLAlchemy ะผะพะดะตะปะธ
โ   โโโ auth.py              # ะะฐะปะธะดะฐัะธั Telegram initData, ะฒัะดะฐัะฐ JWT
โ   โโโ dependencies.py      # ะะฐะฒะธัะธะผะพััะธ FastAPI (current_user ะธ ั.ะด.)
โ   โโโ routers/
โ       โโโ tickets.py
โ       โโโ messages.py
โ       โโโ files.py
โ       โโโ users.py
โโโ frontend/
โ   โโโ index.html           # SPA ัะพัะบะฐ ะฒัะพะดะฐ
โ   โโโ app.js               # ะะพััะธะฝะณ, ะปะพะณะธะบะฐ ัะบัะฐะฝะพะฒ
โ   โโโ style.css
โโโ uploads/                 # ะคะฐะนะปั ะฟะพะปัะทะพะฒะฐัะตะปะตะน (gitignore)
โโโ config.yaml              # ะะพะฝัะธะณ ัะพะปะตะน
โโโ support.db               # SQLite ะฑะฐะทะฐ (gitignore)
โโโ requirements.txt
```

---

## 4. ะะพะฝัะธะณััะฐัะธั (`config.yaml`)

```yaml
bot_token: "YOUR_BOT_TOKEN"
secret_key: "YOUR_JWT_SECRET"

roles:
  admins:
    - 123456789   # telegram_id
  support:
    - 987654321
    - 111222333
```

ะัะธ ะฟะตัะฒะพะผ ะฒัะพะดะต ะฟะพะปัะทะพะฒะฐัะตะปั ะตะณะพ `telegram_id` ัะฒะตััะตััั ั ะบะพะฝัะธะณะพะผ. ะัะปะธ ะฝะฐะนะดะตะฝ โ ะฝะฐะทะฝะฐัะฐะตััั ัะพะปั `admin` ะธะปะธ `support`. ะะฝะฐัะต โ `author`.

---

## 5. ะะฐะทะฐ ะดะฐะฝะฝัั

### `users`

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| id | INTEGER PK | |
| telegram_id | INTEGER UNIQUE | ID ะธะท Telegram |
| username | TEXT | @ะฝะธะบะฝะตะนะผ |
| full_name | TEXT | ะะผั ะธะท ะฟัะพัะธะปั Telegram |
| role | TEXT | `author` / `support` / `admin` |
| created_at | DATETIME | |

> ะะดะธะฝ ะฟะพะปัะทะพะฒะฐัะตะปั ะผะพะถะตั ะธะผะตัั ัะพะปั `support` ะธะปะธ `admin` ะธ ะฟัะธ ััะพะผ ัะพะทะดะฐะฒะฐัั ะพะฑัะฐัะตะฝะธั ะบะฐะบ ะฐะฒัะพั.

### `tickets`

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| id | INTEGER PK | |
| number | TEXT UNIQUE | ะงะตะปะพะฒะตะบะพัะธัะฐะตะผัะน ะฝะพะผะตั, ะฝะฐะฟัะธะผะตั `#2024-001` |
| author_id | INTEGER FK โ users | |
| assigned_to | INTEGER FK โ users | NULL ะตัะปะธ ะฝะธะบัะพ ะฝะต ะฒะทัะป |
| status | TEXT | ัะผ. ัะฐะทะดะตะป 7 |
| is_urgent | BOOLEAN | ะขะตะณ ยซะกัะพัะฝะพยป |
| title | TEXT | ะัะฐัะบะพะต ะฝะฐะทะฒะฐะฝะธะต |
| description | TEXT | ะะฟะธัะฐะฝะธะต ะฟัะพะฑะปะตะผั |
| steps | TEXT | ะจะฐะณะธ ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั |
| url | TEXT | ะกััะปะบะฐ ะฝะฐ ัััะฐะฝะธัั ั ะฟัะพะฑะปะตะผะพะน |
| created_at | DATETIME | |
| updated_at | DATETIME | |

### `ticket_files`

ะคะฐะนะปั, ะฟัะธะบัะตะฟะปัะฝะฝัะต ะบ ะพะฑัะฐัะตะฝะธั ะฟัะธ ัะพะทะดะฐะฝะธะธ ะธะปะธ ัะตะดะฐะบัะธัะพะฒะฐะฝะธะธ.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| id | INTEGER PK | |
| ticket_id | INTEGER FK โ tickets | |
| filename | TEXT | ะัะธะณะธะฝะฐะปัะฝะพะต ะธะผั ัะฐะนะปะฐ |
| stored_path | TEXT | ะััั ะฒ `/uploads/` |
| filesize | INTEGER | ะะฐะนัั |
| uploaded_by | INTEGER FK โ users | |
| uploaded_at | DATETIME | |

### `messages`

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| id | INTEGER PK | |
| ticket_id | INTEGER FK โ tickets | |
| sender_id | INTEGER FK โ users | NULL ะดะปั ัะธััะตะผะฝัั ัะพะพะฑัะตะฝะธะน |
| sender_role | TEXT | `author` / `support` / `system` |
| text | TEXT | |
| created_at | DATETIME | |

> ะกะพะพะฑัะตะฝะธั ะฟะพะดะดะตัะถะบะธ ััะฐะฝัััั ั ัะตะฐะปัะฝัะผ `sender_id`, ะฝะพ ะฒ UI ะฒัะตะณะดะฐ ะพัะพะฑัะฐะถะฐัััั ะบะฐะบ **ยซะะพะดะดะตัะถะบะฐยป** โ ะฑะตะท ะธะผะตะฝะธ ะบะพะฝะบัะตัะฝะพะณะพ ัะพัััะดะฝะธะบะฐ.

### `message_files`

ะคะฐะนะปั, ะพัะฟัะฐะฒะปะตะฝะฝัะต ะฒ ัะฐัะต.

| ะะพะปะต | ะขะธะฟ | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| id | INTEGER PK | |
| message_id | INTEGER FK โ messages | |
| filename | TEXT | |
| stored_path | TEXT | |
| filesize | INTEGER | |

---

## 6. ะะพะปะธ ะธ ะฟัะฐะฒะฐ

| ะะตะนััะฒะธะต | Author | Support | Admin |
|---|:---:|:---:|:---:|
| ะกะพะทะดะฐัั ะพะฑัะฐัะตะฝะธะต | โ | โ | โ |
| ะะธะดะตัั ะฒะบะปะฐะดะบั ยซะัะตยป | โ | โ | โ |
| ะะธะดะตัั ะฒะบะปะฐะดะบั ยซะะพะธยป | โ | โ | โ |
| ะะธะดะตัั ะฒะบะปะฐะดะบั ยซะะฐะบััััะตยป | โ (ัะฒะพะธ) | โ | โ |
| ะะตะดะฐะบัะธัะพะฒะฐัั ะพะฑัะฐัะตะฝะธะต | ัะพะปัะบะพ ัะฒะพะธ, ัะพะปัะบะพ ััะฐััั `new` | โ | โ |
| ะะพััะฐะฒะธัั ัะตะณ ยซะกัะพัะฝะพยป | โ | โ | โ |
| ะกะฝััั ัะตะณ ยซะกัะพัะฝะพยป | โ (ัะฒะพั) | โ | โ |
| ะะทััั ะพะฑัะฐัะตะฝะธะต ะฝะฐ ัะตะฑั | โ | โ | โ |
| ะะตะฝััั ััะฐััั | ัะพะปัะบะพ `closed` (ะธะท `biz_review`) ะธ `reopened` | โ | โ |
| ะะธัะฐัั ะฒ ัะฐั | โ | โ | โ |
| ะัะธะบะปะฐะดัะฒะฐัั ัะฐะนะปั ะฒ ัะฐั | โ | โ | โ |

---

## 7. ะกัะฐัััั ะธ ะฟะตัะตัะพะดั

### ะะฝะฐัะตะฝะธั ััะฐัััะพะฒ

| ะกัะฐััั | ะะพะด | ะะฟะธัะฐะฝะธะต |
|---|---|---|
| ะะพะฒะพะต | `new` | ะขะพะปัะบะพ ััะพ ัะพะทะดะฐะฝะพ, ะฝะธะบัะพ ะฝะต ะฒะทัะป |
| ะ ัะฐะฑะพัะต | `in_progress` | ะกะฟะตัะธะฐะปะธัั ะฒะทัะป ะฝะฐ ัะตะฑั |
| ะะฐ ะฟะฐัะทะต | `on_pause` | ะะพะดะดะตัะถะบะฐ ะฟะพััะฐะฒะธะปะฐ ะฝะฐ ะฟะฐัะทั |
| ะัะพะฒะตัะบะฐ ะฑะธะทะฝะตัะพะผ | `biz_review` | ะะถะธะดะฐะตััั ะพัะฒะตั/ัะตัะตะฝะธะต ะพั ะฐะฒัะพัะฐ |
| ะะฐะบัััะพะต | `closed` | ะะฑัะฐัะตะฝะธะต ะทะฐะบัััะพ |
| ะะตัะตะพัะบัััะพะต | `reopened` | ะะฒัะพั ะฟะตัะตะพัะบััะป ะทะฐะบัััะพะต |

### ะขะฐะฑะปะธัะฐ ะฟะตัะตัะพะดะพะฒ

| ะะท | ะ | ะัะพ ะธะฝะธัะธะธััะตั |
|---|---|---|
| `new` | `in_progress` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ (ะฑะตััั ะฝะฐ ัะตะฑั) |
| `in_progress` | `on_pause` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |
| `in_progress` | `biz_review` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |
| `in_progress` | `closed` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |
| `on_pause` | `in_progress` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |
| `biz_review` | `in_progress` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ (ะฒัััะฝัั) |
| `biz_review` | `closed` | ะะฒัะพั (ะบะฝะพะฟะบะฐ) / ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |
| `closed` | `reopened` | ะะฒัะพั |
| `reopened` | `in_progress` | ะะพะดะดะตัะถะบะฐ / ะะดะผะธะฝ |

> ะัะธ ะฟะตัะตะพัะบัััะธะธ (`closed` โ `reopened`) ะฟะพะปะต `assigned_to` **ะฝะต ัะฑัะฐััะฒะฐะตััั** โ ะพะฑัะฐัะตะฝะธะต ะพััะฐัััั ะทะฐ ัะตะผ ะถะต ัะฟะตัะธะฐะปะธััะพะผ.

> ะะฒัะพั ะฟะธัะตั ะฒ ัะฐั ะฒะพ ะฒัะตะผั `biz_review` โ ััะฐััั **ะฝะต ะผะตะฝัะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ**. ะะพะดะดะตัะถะบะฐ ะฟะตัะตะฒะพะดะธั ะฒ `in_progress` ะฒัััะฝัั.

---

## 8. API

ะัะต ะทะฐัะธััะฝะฝัะต ัะฝะดะฟะพะธะฝัั ััะตะฑััั ะทะฐะณะพะปะพะฒะพะบ `Authorization: Bearer <jwt>`.

### ะะฒัะพัะธะทะฐัะธั

```
POST /auth/telegram
Body: { initData: string }   # ัััะพะน initData ะธะท Telegram.WebApp
Response: { token: string, user: User }
```

### ะะฑัะฐัะตะฝะธั

```
GET  /tickets                # ัะฟะธัะพะบ ะพะฑัะฐัะตะฝะธะน
     ?filter=all|mine|closed
     ?urgent=true            # ัะพะปัะบะพ ััะพัะฝัะต

POST /tickets                # ัะพะทะดะฐัั ะพะฑัะฐัะตะฝะธะต
PUT  /tickets/{id}           # ัะตะดะฐะบัะธัะพะฒะฐัั (ัะพะปัะบะพ author, ัะพะปัะบะพ ััะฐััั new)
PUT  /tickets/{id}/status    # ัะผะตะฝะธัั ััะฐััั
PUT  /tickets/{id}/assign    # ะฒะทััั ะฝะฐ ัะตะฑั (support/admin)
PUT  /tickets/{id}/urgent    # ะฟะพััะฐะฒะธัั/ัะฝััั ัะตะณ ััะพัะฝะพ
GET  /tickets/{id}           # ะดะตัะฐะปะธ ะพะฑัะฐัะตะฝะธั
```

### ะงะฐั

```
GET  /tickets/{id}/messages  # ะธััะพัะธั ัะพะพะฑัะตะฝะธะน
POST /tickets/{id}/messages  # ะพัะฟัะฐะฒะธัั ัะพะพะฑัะตะฝะธะต (text + optional file)
```

### ะคะฐะนะปั

```
POST /tickets/{id}/files     # ะทะฐะณััะทะธัั ัะฐะนะป ะบ ะพะฑัะฐัะตะฝะธั
GET  /files/{stored_path}    # ัะบะฐัะฐัั ัะฐะนะป
```

### ะะณัะฐะฝะธัะตะฝะธั ัะฐะนะปะพะฒ
- ะะฐะบัะธะผะฐะปัะฝัะน ัะฐะทะผะตั: **10 ะะ**
- ะะฐะฟัะตััะฝะฝัะต ัะฐััะธัะตะฝะธั: `.exe`, `.bat`, `.cmd`, `.sh`, `.msi`, `.ps1`, `.vbs`, `.app`, `.bin`, `.dll`, `.com`

---

## 9. ะญะบัะฐะฝั

### ะญะบัะฐะฝ 1 โ ะกะฟะธัะพะบ ะพะฑัะฐัะตะฝะธะน

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  ๐ซ ะะฑัะฐัะตะฝะธั         [+ ะะพะฒะพะต]โ
โ  [ะัะต]  [ะะพะธ]  [ะะฐะบััััะต]      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ๐ด #001 ยท ะกะะะงะะ ยท ะะพะฒะพะต       โ  โ ะฐะบัะตะฝั: ะฝะต ะฒะทััะพ + ััะพัะฝะพะต
โ ะะต ัะฐะฑะพัะฐะตั ะฐะฒัะพัะธะทะฐัะธั         โ
โ @ivan ยท 2 ัะฐัะฐ ะฝะฐะทะฐะด           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ #002 ยท ะ ัะฐะฑะพัะต ยท ะะฒะฐะฝ ะ.       โ  โ ะฒะทััะพ, ะฟะพะบะฐะทะฐะฝ assignee (ะดะปั support/admin)
โ ะัะธะฑะบะฐ ะฟัะธ ะพะฟะปะฐัะต               โ
โ @marina ยท ะฒัะตัะฐ                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ #003 ยท ะะพะฒะพะต                    โ  โ ะฐะบัะตะฝั: ะฝะต ะฒะทััะพ
โ ะะฝะพะฟะบะฐ ะฝะต ัะฐะฑะพัะฐะตั              โ
โ @petrov ยท 5 ะผะธะฝัั ะฝะฐะทะฐะด         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะธะทัะฐะปัะฝัะต ะฐะบัะตะฝัั:**
- ะะต ะฒะทัััะต (`assigned_to IS NULL`) โ ะฐะบัะตะฝัะฝัะน ัะฒะตั ะบะฐััะพัะบะธ (ะฝะฐะฟัะธะผะตั, ะพัะฐะฝะถะตะฒะฐั ะปะตะฒะฐั ะณัะฐะฝะธัะฐ)
- ะกัะพัะฝัะต โ ะฑะตะนะดะถ ๐ด ะกะะะงะะ
- ะะพะผะฑะธะฝะฐัะธั ะฝะต ะฒะทััะพ + ััะพัะฝะพะต โ ะผะฐะบัะธะผะฐะปัะฝัะน ะฐะบัะตะฝั

### ะญะบัะฐะฝ 2 โ ะกะพะทะดะฐะฝะธะต / ัะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะพะฑัะฐัะตะฝะธั

ะะพะปั:
- ะะฐะณะพะปะพะฒะพะบ (ะพะฑัะทะฐัะตะปัะฝะพ)
- ะะฟะธัะฐะฝะธะต ะฟัะพะฑะปะตะผั (ะพะฑัะทะฐัะตะปัะฝะพ)
- ะจะฐะณะธ ะดะปั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธั
- ะกััะปะบะฐ ะฝะฐ ัััะฐะฝะธัั
- ะัะธะบัะตะฟะธัั ัะฐะนะปั (ะบะฝะพะฟะบะฐ, ะผัะปััะธัะตะปะตะบั)
- ะงะตะบะฑะพะบั ยซะกัะพัะฝะพยป

ะะตะดะฐะบัะธัะพะฒะฐะฝะธะต ะดะพัััะฟะฝะพ ัะพะปัะบะพ ะฐะฒัะพัั ะธ ัะพะปัะบะพ ะฒ ััะฐัััะต `new`.

### ะญะบัะฐะฝ 3 โ ะะตัะฐะปะธ ะพะฑัะฐัะตะฝะธั

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ โ  #001 ยท ๐ด ะกะะะงะะ            โ
โ     [ะกัะฐััั: ะะพะฒะพะต โพ]          โ  โ dropdown ัะพะปัะบะพ ะดะปั support/admin
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ ะะต ัะฐะฑะพัะฐะตั ะฐะฒัะพัะธะทะฐัะธั         โ
โ                                 โ
โ ะะฟะธัะฐะฝะธะต:                       โ
โ ะัะธ ะฟะพะฟััะบะต ะฒะพะนัะธ ัะตัะตะท...      โ
โ                                 โ
โ ะจะฐะณะธ:                           โ
โ 1. ะัะบัััั /auth                โ
โ 2. ะะฐะถะฐัั "ะะพะนัะธ"               โ
โ                                 โ
โ ะกััะปะบะฐ: app.example.com/auth    โ
โ                                 โ
โ ๐ screenshot.png   ๐ log.txt  โ
โ                                 โ
โ ะะฒัะพั: @ivan ยท 2 ัะฐัะฐ ะฝะฐะทะฐะด     โ
โ [โ๏ธ ะะตะดะฐะบัะธัะพะฒะฐัั]              โ  โ ัะพะปัะบะพ ะดะปั ะฐะฒัะพัะฐ ะฒ ััะฐัััะต new
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ โโ ะงะฐั โโโโโโโโโโโโโโโโโโโโโโ  โ
โ                                 โ
โ  @ivan:                         โ
โ  ะะพะฑััะน ะดะตะฝั, ะฟะพะผะพะณะธัะต          โ
โ                         10:32   โ
โ                                 โ
โ           ะะพะดะดะตัะถะบะฐ:            โ
โ           ะกะผะพััะธะผ...    10:35   โ
โ                                 โ
โ  @ivan:                         โ
โ  ะะพั ัะบัะธะฝ ๐ img.png   10:40   โ
โ                                 โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ [๐] [  ะะฐะฟะธัะฐัั...  ]   [ โ ] โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

**ะะฝะพะฟะบะฐ "ะะฐะบัััั ะพะฑัะฐัะตะฝะธะต"** ะพัะพะฑัะฐะถะฐะตััั ั ะฐะฒัะพัะฐ ัะพะปัะบะพ ะฒ ััะฐัััะต `biz_review`.  
**ะะฝะพะฟะบะฐ "ะะทััั ะฝะฐ ัะตะฑั"** โ ั ะฟะพะดะดะตัะถะบะธ/ะฐะดะผะธะฝะฐ, ะตัะปะธ `assigned_to IS NULL`.  
**Dropdown ัะผะตะฝั ััะฐัััะฐ** โ ัะพะปัะบะพ ะดะปั ะฟะพะดะดะตัะถะบะธ/ะฐะดะผะธะฝะฐ, ะฟะพะบะฐะทัะฒะฐะตั ะดะพะฟัััะธะผัะต ะฟะตัะตัะพะดั ะธะท ัะตะบััะตะณะพ ััะฐัััะฐ.

---

## 10. ะฃะฒะตะดะพะผะปะตะฝะธั

ะัะต ัะฒะตะดะพะผะปะตะฝะธั ะพัะฟัะฐะฒะปััััั ะพั ะธะผะตะฝะธ ะฑะพัะฐ. ะะฝะพะฟะบะฐ **ยซะัะบััััยป** ะทะฐะฟััะบะฐะตั WebApp ะฝะฐ ะฝัะถะฝะพะผ ะพะฑัะฐัะตะฝะธะธ ัะตัะตะท deep link: `?startapp=ticket_001`.

| ะกะพะฑััะธะต | ะะพะผั | ะขะธะฟ |
|---|---|---|
| ะกะพะทะดะฐะฝะพ ะฝะพะฒะพะต ะพะฑัะฐัะตะฝะธะต (ะพะฑััะฝะพะต) | ะัะต support + admins | ะกัะฐะฝะดะฐััะฝะพะต |
| ะกะพะทะดะฐะฝะพ ะพะฑัะฐัะตะฝะธะต ั ัะตะณะพะผ ยซะกัะพัะฝะพยป | ะัะต support + admins | ๐ด ะก ะฟะพะผะตัะบะพะน ะกะะะงะะ |
| ะะพััะฐะฒะปะตะฝ ัะตะณ ยซะกัะพัะฝะพยป ะฝะฐ ัััะตััะฒัััะตะต | ะัะต support + admins | ๐ด ะก ะฟะพะผะตัะบะพะน ะกะะะงะะ |
| ะกัะฐััั ะธะทะผะตะฝะธะปัั | ะะฒัะพั ะพะฑัะฐัะตะฝะธั | ะกัะฐะฝะดะฐััะฝะพะต |
| ะะฑัะฐัะตะฝะธะต ะฒะทััะพ ัะฟะตัะธะฐะปะธััะพะผ | ะะฒัะพั ะพะฑัะฐัะตะฝะธั | ะกัะฐะฝะดะฐััะฝะพะต |
| ะะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะฒ ัะฐัะต | ะะฒัะพั (ะตัะปะธ ะฟะธัะตั ะฟะพะดะดะตัะถะบะฐ) / ะัะต support+admins (ะตัะปะธ ะฟะธัะตั ะฐะฒัะพั) | ะกัะฐะฝะดะฐััะฝะพะต |
| ะกัะฐััั ััะฐะป `biz_review` | ะะฒัะพั ะพะฑัะฐัะตะฝะธั | ะก ะบะฝะพะฟะบะพะน ยซะัะบัััั ะธ ะพัะฒะตัะธััยป |

---

## 11. ะะฒัะพัะธะทะฐัะธั ะธ ะฑะตะทะพะฟะฐัะฝะพััั

1. Frontend ะฟัะธ ะพัะบัััะธะธ ะฟะพะปััะฐะตั `window.Telegram.WebApp.initData`
2. ะัะฟัะฐะฒะปัะตั ะฝะฐ `POST /auth/telegram`
3. Backend ะฒะตัะธัะธัะธััะตั HMAC-ะฟะพะดะฟะธัั ัะพะณะปะฐัะฝะพ [ะดะพะบัะผะตะฝัะฐัะธะธ Telegram](https://core.telegram.org/bots/webapps#validating-data-received-via-the-mini-app)
4. ะะทะฒะปะตะบะฐะตั `user.id`, `user.username`, `user.first_name`
5. ะกะพะทะดะฐัั ะธะปะธ ะพะฑะฝะพะฒะปัะตั ะทะฐะฟะธัั ะฒ `users`, ะฟัะพััะฐะฒะปัะตั ัะพะปั ะฟะพ ะบะพะฝัะธะณั
6. ะะพะทะฒัะฐัะฐะตั JWT (ััะพะบ ะถะธะทะฝะธ: 24 ัะฐัะฐ)

---

## 12. ะกะธััะตะผะฝัะต ัะพะพะฑัะตะฝะธั ะฒ ัะฐัะต

ะัะธ ัะผะตะฝะต ััะฐัััะฐ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะดะพะฑะฐะฒะปัะตััั ัะพะพะฑัะตะฝะธะต ั `sender_role = system`:

```
โโ ะกัะฐััั ะธะทะผะตะฝัะฝ: ะะพะฒะพะต โ ะ ัะฐะฑะพัะต โโโโโโโโ 10:35
โโ ะขะตะณ ยซะกัะพัะฝะพยป ัััะฐะฝะพะฒะปะตะฝ โโโโโโโโโโโโโโโโโ 11:00
โโ ะกัะฐััั ะธะทะผะตะฝัะฝ: ะ ัะฐะฑะพัะต โ ะัะพะฒะตัะบะฐ ะฑะธะทะฝะตัะพะผ โโ 12:15
โโ ะะฑัะฐัะตะฝะธะต ะทะฐะบัััะพ โโโโโโโโโโโโโโโโโโโโโโโ 14:00
โโ ะะฑัะฐัะตะฝะธะต ะฟะตัะตะพัะบัััะพ โโโโโโโโโโโโโโโโโโโ 15:30
```

---

## 13. ะขัะตะฑะพะฒะฐะฝะธั ะบ ัะตะฐะปะธะทะฐัะธะธ

- [ ] ะะฐะปะธะดะฐัะธั Telegram initData ะฝะฐ ะบะฐะถะดัะน ะทะฐะฟัะพั ะบ API (ัะตัะตะท JWT)
- [ ] ะะฐะฟัะตั ะทะฐะณััะทะบะธ ะธัะฟะพะปะฝัะตะผัั ัะฐะนะปะพะฒ (ะฟัะพะฒะตัะบะฐ ัะฐััะธัะตะฝะธั + MIME-type)
- [ ] ะคะฐะนะปั ััะฐะฝัััั ะฒ `/uploads/{ticket_id}/{uuid}_{filename}`
- [ ] ะะตะปัะทั ะพะฑัะฐัะธัััั ะบ ัะฐะนะปะฐะผ ััะถะธั ัะธะบะตัะพะฒ (ะฟัะพะฒะตัะบะฐ ะฟัะฐะฒ ะฟัะธ `/files/{path}`)
- [ ] ะัะธ ัะผะตะฝะต ััะฐัััะฐ โ ัะธััะตะผะฝะพะต ัะพะพะฑัะตะฝะธะต ะฒ ัะฐั + ัะฒะตะดะพะผะปะตะฝะธะต ะฒ ะฑะพั
- [ ] `updated_at` ั ัะธะบะตัะฐ ะพะฑะฝะพะฒะปัะตััั ะฟัะธ ะปัะฑะพะผ ะธะทะผะตะฝะตะฝะธะธ (ััะฐััั, ัะพะพะฑัะตะฝะธะต, ัะฐะนะป)
- [ ] ะะตะฝะตัะฐัะธั `number` โ ัะพัะผะฐั `#YYYY-NNN`, ะฐะฒัะพะธะฝะบัะตะผะตะฝั ะฒ ัะฐะผะบะฐั ะณะพะดะฐ
